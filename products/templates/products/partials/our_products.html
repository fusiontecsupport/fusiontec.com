
{% load static %}
<!-- Products Section -->
<section class="py-5" id="products">
  <div class="container px-4 px-lg-5 mb-5">
    {% if messages %}
    <div class="mt-2">
      {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      {% endfor %}
    </div>
    {% endif %}
    <div class="text-center mb-5">
      <h1 class="display-5 fw-bolder mb-0" data-aos="fade-up">
        <span class="text-gradient d-inline">Our Products</span>
      </h1>
      <p class="lead fw-light mt-3" data-aos="fade-up" data-aos-delay="200">Comprehensive software solutions for your business needs</p>
    </div>

    <style>
      /* Scoped inline styles for product cards */
      #products .product-type-card,
      #products .product-card {
        border-radius: 16px;
        border: 1px solid #e9ecef;
        background: linear-gradient(180deg, #ffffff, #f9fbff);
        transition: transform .2s ease, box-shadow .2s ease, border-color .2s ease;
      }
      #products .product-type-card:hover,
      #products .product-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 12px 28px rgba(16, 24, 40, .08);
        border-color: #d0d7e2;
      }
      #products .image-wrap {
        position: relative;
        width: 100%;
        padding-top: 56.25%;
        background: #ffffff;
        border-radius: 12px;
        overflow: hidden;
        border: 1px solid #eef2f6;
      }
      #products .image-wrap > img,
      #products .image-wrap > .placeholder {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        object-fit: contain;
        object-position: center;
      }
      #products .product-title { font-weight: 600; }
      #products .btn-pill { border-radius: 999px; }

      /* Enhanced Button Styling - More Attractive Colors */
      #products .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        color: white;
        font-weight: 600;
        text-shadow: 0 1px 2px rgba(0,0,0,0.1);
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        transition: all 0.3s ease;
      }

      /* Horizontal Product Card Layout Styling */
      #products .product-card,
      #products .product-type-card {
        border-radius: 16px;
        overflow: hidden;
        transition: all 0.3s ease;
        background: #fff;
        border: 1px solid #e9ecef;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      }

      #products .product-card:hover,
      #products .product-type-card:hover {
        transform: translateY(-6px);
        box-shadow: 0 20px 40px rgba(16, 24, 40, 0.15);
        border-color: #d0d7e2;
      }

      /* Product Content Styling */
      #products .product-heading {
        color: #343a40;
        font-weight: 600;
        font-size: 1.5rem;
        font-family: 'Arial', sans-serif;
        margin-bottom: 1rem;
      }

      /* Button container styling */
      #products .product-card .d-flex.gap-3,
      #products .product-type-card .d-flex.gap-3 {
        gap: 1rem !important;
      }

      /* Error message styling */
      .error-message {
        color: #dc3545;
        font-size: 0.875rem;
        margin-top: 0.25rem;
        font-weight: 500;
      }

      #products .product-card .btn,
      #products .product-type-card .btn {
        flex: 1;
        max-width: 140px;
      }

      /* Responsive adjustments for horizontal layout */
      @media (max-width: 767.98px) {
        #products .product-card .row,
        #products .product-type-card .row {
          flex-direction: column;
        }
        
        #products .product-card .col-md-4,
        #products .product-card .col-md-8,
        #products .product-type-card .col-md-4,
        #products .product-type-card .col-md-8 {
          width: 100%;
        }
      }

      /* DSC Card Styling */
      #products .dsc-card {
        border-radius: 16px;
        overflow: hidden;
        transition: all 0.3s ease;
        background: #fff;
        border: 1px solid #e9ecef;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      }

      #products .dsc-card:hover {
        transform: translateY(-6px);
        box-shadow: 0 20px 40px rgba(16, 24, 40, 0.15);
        border-color: #d0d7e2;
      }

      /* eMudhra Logo Styling */
      #products .emudhra-logo {
        font-family: 'Arial', sans-serif;
        font-weight: bold;
        font-size: 2.5rem;
        line-height: 1;
      }

      #products .logo-e {
        color: #28a745;
        background: #6f42c1;
        border-radius: 50%;
        padding: 8px 12px;
        margin-right: 4px;
        display: inline-block;
        width: 60px;
        height: 60px;
        line-height: 44px;
        text-align: center;
        vertical-align: middle;
      }

      #products .logo-mudhra {
        color: #fd7e14;
        font-size: 2.2rem;
        vertical-align: middle;
      }

      /* Tagline Styling */
      #products .tagline {
        margin-top: 1rem;
      }

      #products .tagline-text {
        color: #6f42c1;
        font-size: 1rem;
        font-weight: 500;
        font-family: 'Arial', sans-serif;
      }

      #products .tagline-underline {
        height: 2px;
        background: linear-gradient(90deg, #28a745, #20c997);
        margin-top: 4px;
        border-radius: 1px;
      }

      /* Product Description Styling */
      #products .product-description {
        color: #6c757d;
        font-size: 1rem;
        line-height: 1.6;
        margin-bottom: 1.5rem;
      }

      /* Button Styling for DSC Card */
      #products .btn-buy-online {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        color: white;
        font-weight: 600;
        padding: 12px 24px;
        border-radius: 25px;
        text-decoration: none;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        min-width: 120px;
        text-align: center;
      }

      #products .btn-buy-online:hover {
        background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
        color: white;
      }

      #products .btn-enquiry {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        border: none;
        color: white;
        font-weight: 600;
        padding: 12px 24px;
        border-radius: 25px;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(240, 147, 251, 0.3);
        min-width: 120px;
        text-align: center;
      }

      #products .btn-enquiry:hover {
        background: linear-gradient(135deg, #e085e8 0%, #e04a5f 100%);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(240, 147, 251, 0.5);
        color: white;
      }

      /* Responsive adjustments for DSC card */
      @media (max-width: 767.98px) {
        #products .dsc-card .row {
          flex-direction: column;
        }
        
        #products .dsc-card .col-md-4,
        #products .dsc-card .col-md-8 {
          width: 100%;
        }
        
        #products .emudhra-logo {
          font-size: 2rem;
        }
        
        #products .logo-e {
          width: 50px;
          height: 50px;
          line-height: 34px;
          font-size: 1.8rem;
        }
        
        #products .logo-mudhra {
          font-size: 1.8rem;
        }
      }
      #products .btn-primary:hover {
        background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
      }

      #products .btn-outline-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        color: white;
        font-weight: 600;
        text-shadow: 0 1px 2px rgba(0,0,0,0.1);
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        transition: all 0.3s ease;
      }
      #products .btn-outline-primary:hover {
        background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
      }

      #products .btn-light {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        border: none;
        color: white;
        font-weight: 600;
        text-shadow: 0 1px 2px rgba(0,0,0,0.1);
        box-shadow: 0 4px 15px rgba(240, 147, 251, 0.4);
        transition: all 0.3s ease;
      }
      #products .btn-light:hover {
        background: linear-gradient(135deg, #e085e8 0%, #e04a5f 100%);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(240, 147, 251, 0.6);
      }

      #products .btn-get-quote {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        border: none;
        color: white;
        font-weight: 600;
        text-shadow: 0 1px 2px rgba(0,0,0,0.1);
        box-shadow: 0 4px 15px rgba(79, 172, 254, 0.4);
        transition: all 0.3s ease;
      }
      #products .btn-get-quote:hover {
        background: linear-gradient(135deg, #3e9be8 0%, #00d8e0 100%);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(79, 172, 254, 0.6);
      }

      #products .btn-secondary {
        background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
        border: none;
        color: #333;
        font-weight: 600;
        box-shadow: 0 4px 15px rgba(168, 237, 234, 0.4);
        transition: all 0.3s ease;
      }
      #products .btn-secondary:hover {
        background: linear-gradient(135deg, #97dcd9 0%, #edc5d0 100%);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(168, 237, 234, 0.6);
      }

      /* Button/layout overrides – scoped to #products */
      #products .card-body > .d-flex {
        min-height: auto !important;
        flex-direction: row !important;
        align-items: center !important;
        gap: .5rem;
      }
      #products .btn,
      #products .card-body > .d-flex .btn {
        width: auto !important;
        margin-bottom: 0 !important;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        height: auto !important;
        white-space: nowrap;
        border-radius: 8px;
        padding: 8px 20px;
        font-size: 14px;
        letter-spacing: 0.5px;
      }
    </style>

    <!-- Product Types (from ProductTypeMaster) - Horizontal Cards -->
    <div class="row g-4 justify-content-center" data-aos="fade-up" data-aos-delay="150">
      {% for pt in product_type_masters %}
        {% comment %} Skip DSC/Digital Signature Certificate as it has its own separate section {% endcomment %}
        {% if "dsc" not in pt.prdt_desc|lower and "digital signature" not in pt.prdt_desc|lower and "mudhra" not in pt.prdt_desc|lower %}
        <div class="col-12 col-lg-10 col-xl-8">
          <div class="card product-type-card h-100 shadow-sm border-0">
            <div class="row g-0 h-100">
              <!-- Left Section - Image/Logo -->
              <div class="col-md-4 d-flex align-items-center justify-content-center p-4" style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);">
                {% if pt.image %}
                  <div class="image-wrap">
                    <img src="{{ pt.image.url }}" alt="{{ pt.prdt_desc }}" />
                  </div>
                {% else %}
                  <div class="image-wrap d-flex align-items-center justify-content-center" style="background:#f3f6f9;">
                    <div class="placeholder d-flex align-items-center justify-content-center">
                      <i class="bi bi-image text-muted" style="font-size:2rem;"></i>
                    </div>
                  </div>
                {% endif %}
              </div>
              
              <!-- Right Section - Product Info & CTA -->
              <div class="col-md-8 p-4 d-flex flex-column justify-content-center">
                <h3 class="product-heading mb-3">{{ pt.prdt_desc }}</h3>
                <p class="product-description mb-4">Explore solutions under {{ pt.prdt_desc }}.</p>
                <div class="d-flex gap-3 flex-wrap">
                  <a href="{% url 'product_type_form' pt.prdt_desc|slugify %}" class="btn btn-buy-online">Buy Online</a>
                  <button type="button" class="btn btn-enquiry" data-quote-btn data-pt-id="{{ pt.id }}" data-pt-name="{{ pt.prdt_desc|escapejs }}">Enquiry</button>
                </div>
              </div>
            </div>
          </div>
        </div>
        {% endif %}
      {% empty %}
      <div class="col-12">
        <div class="alert alert-info text-center">No product types available yet.</div>
      </div>
      {% endfor %}
    </div>
    <!-- End Product Types -->



    <!-- Quote Form Modal -->
    <div class="modal fade" id="quoteFormModal" tabindex="-1" aria-labelledby="quoteFormModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content rounded-4 shadow-lg">
                <div class="modal-header border-0 bg-gradient-primary text-white">
                    <h5 class="modal-title" id="quoteFormModalLabel">
                        <i class="bi bi-chat-dots me-2"></i>
                        Product Enquiry
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form method="POST" action="{% url 'submit_quote' %}" enctype="multipart/form-data" id="quoteForm">
                    {% csrf_token %}
                    <input type="hidden" name="product_type_id" id="quote_product_type_id">
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label fw-semibold">Product Type</label>
                                    <input type="text" class="form-control" id="quote_product_type_name" readonly>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label fw-semibold">Date</label>
                                    <input type="text" class="form-control" id="quote_date" readonly>
                                </div>
                            </div>
                        </div>
                        
                        <hr class="my-4">
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label fw-semibold">Full Name *</label>
                                    <input type="text" name="customer_name" class="form-control" placeholder="Enter your full name" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label fw-semibold">Email Address *</label>
                                    <input type="email" name="email" class="form-control" placeholder="Enter your email" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label fw-semibold">Mobile Number *</label>
                                    <input type="tel" name="mobile" id="productMobile" class="form-control" placeholder="Enter mobile number" maxlength="10" pattern="[0-9]*" inputmode="numeric" required>
                                    <div class="error-message" id="error-productMobile"></div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label fw-semibold">GST Number *</label>
                                    <input type="text" name="gst_number" class="form-control" placeholder="Enter GST number" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label fw-semibold">Message *</label>
                            <textarea name="message" class="form-control" rows="4" placeholder="Please describe your requirements or any additional information (max 1000 characters)" maxlength="1000" required></textarea>
                            <div class="form-text text-muted">Maximum 1000 characters allowed</div>
                        </div>
                    </div>
                    <div class="modal-footer border-0 d-flex align-items-center gap-3">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" id="quoteSubmitBtn" class="btn btn-get-quote">
                            <i class="bi bi-send me-2"></i>
                            Submit Enquiry
                        </button>
                        <span id="quoteSuccessMsg" class="ms-2" style="display:none;"></span>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="row gx-5 justify-content-center">
      <div class="col-lg-11 col-xl-9 col-xxl-8">
        {% for product in products %}
        <div class="card product-card overflow-hidden rounded-4 border-0 mb-4" data-aos="fade-up">
          <div class="row g-0 h-100">
            <!-- Left Section - Image/Logo -->
            <div class="col-md-4 d-flex align-items-center justify-content-center p-4" style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);">
              <a href="{{ product.tally_link|default:'#' }}" target="_blank" rel="noopener noreferrer" class="d-block text-center">
                {% if product.tally_image %}
                  <div class="image-wrap">
                    <img src="{{ product.tally_image.url }}" alt="{{ product.tally_name }}" />
                  </div>
                {% else %}
                  <div class="image-wrap" style="background-color:#f8f9fa;">
                    <div class="placeholder d-flex align-items-center justify-content-center">
                      <i class="bi bi-image text-muted" style="font-size: 3rem;"></i>
                    </div>
                  </div>
                {% endif %}
              </a>
            </div>
            
            <!-- Right Section - Product Info & CTA -->
            <div class="col-md-8 p-4 d-flex flex-column justify-content-center">
              {% if product.tally_name %}
                <h3 class="product-heading mb-3">{{ product.tally_name }}</h3>
              {% endif %}
              <div class="d-flex gap-3 flex-wrap">
                <button id="sendEnquiryBtn" class="btn btn-primary btn-pill px-4">Send Enquiry</button>
                <a href="{{ product.tally_link|default:'#' }}" target="_blank" rel="noopener noreferrer" class="btn btn-outline-primary btn-pill px-4">More Details</a>
                <a href="{% url 'tally_form' %}" class="btn btn-light btn-pill px-4">Price list</a>
              </div>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>

    <!-- Second loop for Emudhra_2 products -->
    <div class="row gx-5 justify-content-center">
      <div class="col-lg-11 col-xl-9 col-xxl-8">
        {% for product in emudhra_products %}
        <div class="card product-card overflow-hidden rounded-4 border-0 mb-4" data-aos="fade-up">
          <div class="row g-0 h-100">
            <!-- Left Section - Image/Logo -->
            <div class="col-md-4 d-flex align-items-center justify-content-center p-4" style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);">
              <a href="{{ product.emudhra_link|default:'#' }}" target="_blank" rel="noopener noreferrer" class="d-block text-center">
                {% if product.emudhra_image %}
                  <div class="image-wrap">
                    <img src="{{ product.emudhra_image.url }}" alt="{{ product.emudhra_name }}" />
                  </div>
                {% else %}
                  <div class="image-wrap" style="background-color:#f8f9fa;">
                    <div class="placeholder d-flex align-items-center justify-content-center">
                      <i class="bi bi-image text-muted" style="font-size: 3rem;"></i>
                    </div>
                  </div>
                {% endif %}
              </a>
            </div>
            
            <!-- Right Section - Product Info & CTA -->
            <div class="col-md-8 p-4 d-flex flex-column justify-content-center">
              {% if product.emudhra_name %}
                <h3 class="product-heading mb-3">{{ product.emudhra_name }}</h3>
              {% endif %}
              <div class="d-flex gap-3 flex-wrap">
                <button id="sendEnquiryBtn2" class="btn btn-primary btn-pill px-4">Send Enquiry</button>
                <a href="{{ product.emudhra_link|default:'#' }}" target="_blank" rel="noopener noreferrer" class="btn btn-outline-primary btn-pill px-4">More Details</a>
                <a href="{% url 'emudhra_form' %}" class="btn btn-light btn-pill px-4">Price list</a>
              </div>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>

    <!-- Third loop for Fusiontec products -->
    <div class="row gx-5 justify-content-center">
      <div class="col-lg-11 col-xl-9 col-xxl-8">
        {% for product in fusiontec_products %}
        <div class="card product-card overflow-hidden rounded-4 border-0 mb-4" data-aos="fade-up">
          <div class="row g-0 h-100">
            <!-- Left Section - Image/Logo -->
            <div class="col-md-4 d-flex align-items-center justify-content-center p-4" style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);">
              <a href="{{ product.fusiontec_link|default:'#' }}" target="_blank" rel="noopener noreferrer" class="d-block text-center">
                {% if product.fusiontec_image %}
                  <div class="image-wrap">
                    <img src="{{ product.fusiontec_image.url }}" alt="{{ product.fusiontec_name }}" />
                  </div>
                {% else %}
                  <div class="image-wrap" style="background-color:#f8f9fa;">
                    <div class="placeholder d-flex align-items-center justify-content-center">
                      <i class="bi bi-image text-muted" style="font-size: 3rem;"></i>
                    </div>
                  </div>
                {% endif %}
              </a>
            </div>
            
            <!-- Right Section - Product Info & CTA -->
            <div class="col-md-8 p-4 d-flex flex-column justify-content-center">
              {% if product.fusiontec_name %}
                <h3 class="product-heading mb-3">{{ product.fusiontec_name }}</h3>
              {% endif %}
              <div class="d-flex gap-3 flex-wrap">
                <button id="sendEnquiryBtn3" class="btn btn-primary btn-pill px-4">Send Enquiry</button>
                <a href="{{ product.fusiontec_link|default:'#' }}" target="_blank" rel="noopener noreferrer" class="btn btn-outline-primary btn-pill px-4">More Details</a>
                <a href="{% url 'fusiontec_form' %}" class="btn btn-light btn-pill px-4">Price list</a>
              </div>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>

    <!-- Fourth loop for Biz_analyst products -->
    <div class="row gx-5 justify-content-center">
      <div class="col-lg-11 col-xl-9 col-xxl-8">
        {% for product in biz_products %}
        <div class="card product-card overflow-hidden rounded-4 border-0 mb-4" data-aos="fade-up">
          <div class="row g-0 h-100">
            <!-- Left Section - Image/Logo -->
            <div class="col-md-4 d-flex align-items-center justify-content-center p-4" style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);">
              <a href="{{ product.biz_link|default:'#' }}" target="_blank" rel="noopener noreferrer" class="d-block text-center">
                {% if product.biz_image %}
                  <div class="image-wrap">
                    <img src="{{ product.biz_image.url }}" alt="{{ product.biz_name }}" />
                  </div>
                {% else %}
                  <div class="image-wrap" style="background-color:#f8f9fa;">
                    <div class="placeholder d-flex align-items-center justify-content-center">
                      <i class="bi bi-image text-muted" style="font-size: 3rem;"></i>
                    </div>
                  </div>
                {% endif %}
              </a>
            </div>
            
            <!-- Right Section - Product Info & CTA -->
            <div class="col-md-8 p-4 d-flex flex-column justify-content-center">
              {% if product.biz_name %}
                <h3 class="product-heading mb-3">{{ product.biz_name }}</h3>
              {% endif %}
              <div class="d-flex gap-3 flex-wrap">
                <button id="sendEnquiryBtn4" class="btn btn-primary btn-pill px-4">Send Enquiry</button>
                <a href="{{ product.biz_link|default:'#' }}" target="_blank" rel="noopener noreferrer" class="btn btn-outline-primary btn-pill px-4">More Details</a>
                <a href="{% url 'biz_form' %}" class="btn btn-light btn-pill px-4">Price list</a>
              </div>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
        </div>
  </div>
</section>

<style>
  /* Clean popup look with normal Bootstrap backdrop and spacing */
  .product-modal .modal-dialog {
    width: min(1100px, 96vw);
    max-width: none;
    margin: 2vh auto;
  }
  .product-modal .modal-content { border-radius: 14px; box-shadow: 0 20px 60px rgba(0,0,0,0.2); }
  .product-modal .modal-header { border-bottom: none; }
  .product-modal .modal-footer { border-top: none; }

  /* Horizontal, well-aligned items grid inside the popup */
  .product-modal .product-list {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 10px;
    padding: 0;
    margin: 0;
    list-style: none;
  }
  .product-modal .product-list .list-group-item {
    border: 1px solid #eef2f6;
    border-radius: 10px;
    padding: 10px 12px;
    display: flex;
    align-items: center;
    gap: 8px;
    background: #fff;
  }
  .product-modal .product-list .list-group-item i {
    color: #2563eb;
  }
  .product-modal .product-title { margin-bottom: 12px; }

  /* Disable internal scroll in the popup; let page scroll instead */
  .product-modal .modal-content { max-height: none !important; }
  .product-modal .modal-body { overflow: visible !important; max-height: none !important; }

  /* Image panel styling */
  .product-modal .product-modal-image { background: #fff; border: 1px solid #eef2f6; }
  .product-modal .modal-body .row.g-4 { align-items: flex-start; }

  /* Pill cards for product items */
  .product-modal .product-list .list-group-item {
    transition: transform .15s ease, box-shadow .15s ease;
  }
  .product-modal .product-list .list-group-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(0,0,0,0.06);
  }

  /* Responsive tweaks */
  @media (max-width: 767.98px){
    .product-modal .modal-dialog { width: 96vw; margin: 1.5vh auto; }
    .product-modal .product-list { grid-template-columns: 1fr; }
  }

  /* Use default Bootstrap stacking/overlay; no overrides */
</style>

<script>
// Function to show quote form modal
function showQuoteForm(productTypeId, productTypeName) {
    // Set the product type information
    document.getElementById('quote_product_type_id').value = productTypeId;
    document.getElementById('quote_product_type_name').value = productTypeName;
    
    // Set current date
    const today = new Date();
    const dateString = today.toLocaleDateString('en-US', { 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
    });
    document.getElementById('quote_date').value = dateString;
    
    // Show the modal
    const modal = new bootstrap.Modal(document.getElementById('quoteFormModal'));
    modal.show();
}


                // Delegate click for Enquiry buttons (no inline JS)
document.addEventListener('click', function(e) {
    const btn = e.target.closest('[data-quote-btn]');
    if (!btn) return;
    const ptId = btn.getAttribute('data-pt-id');
    const ptName = btn.getAttribute('data-pt-name') || '';
    showQuoteForm(ptId, ptName);
});

// Handle quote form submit via AJAX to show inline success then redirect to #products
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('quoteForm');
    if (!form) return;
    const submitBtn = document.getElementById('quoteSubmitBtn');
    const msgEl = document.getElementById('quoteSuccessMsg');
    const mobileInput = document.getElementById('productMobile');

    // Mobile validation function
    function validateMobileField(field, errorId) {
        const value = field.value.trim();
        const errorDiv = document.getElementById(errorId);
        
        // Remove non-numeric characters and limit to 10 digits
        field.value = value.replace(/\D/g, '').slice(0, 10);
        
        if (!value) {
            errorDiv.textContent = 'Mobile number is required';
            return false;
        } else if (!/^[6-9]\d{9}$/.test(field.value)) {
            errorDiv.textContent = 'Enter a valid 10-digit mobile number starting with 6-9';
            return false;
        } else {
            errorDiv.textContent = '';
            return true;
        }
    }

    // Add mobile validation event listeners
    if (mobileInput) {
        mobileInput.addEventListener('input', () => {
            validateMobileField(mobileInput, 'error-productMobile');
        });
        mobileInput.addEventListener('blur', () => {
            validateMobileField(mobileInput, 'error-productMobile');
        });
    }

    form.addEventListener('submit', async function(ev) {
        ev.preventDefault();
        
        // Validate mobile number before submission
        if (mobileInput && !validateMobileField(mobileInput, 'error-productMobile')) {
            return; // Stop submission if mobile is invalid
        }
        
        try {
            if (submitBtn) {
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Submitting...';
            }
            if (msgEl) {
                msgEl.style.display = 'none';
                msgEl.className = 'ms-2';
                msgEl.textContent = '';
            }

            const fd = new FormData(form);
            const csrfToken = form.querySelector('[name=csrfmiddlewaretoken]')?.value || '';
            const resp = await fetch(form.action, {
                method: 'POST',
                headers: { 
                    'X-Requested-With': 'XMLHttpRequest',
                    'X-CSRFToken': csrfToken
                },
                body: fd
            });
            let data;
            if (resp.ok) {
                // Try to parse JSON; if not JSON, treat as error
                try {
                    data = await resp.json();
                } catch (e) {
                    data = { status: 'error', message: 'Unexpected response format' };
                }
            } else {
                const text = await resp.text().catch(() => '');
                data = { status: 'error', message: text || ('Request failed: ' + resp.status) };
            }
            if (data.status === 'success') {
                if (msgEl) {
                    msgEl.textContent = 'Enquiry submitted successfully';
                    msgEl.style.display = '';
                    msgEl.classList.add('text-success', 'small');
                }
                // Mark success for landing page message
                try { localStorage.setItem('enquiry_success', '1'); } catch (e) {}
                // Close modal if open, then redirect
                try {
                    const modalEl = document.getElementById('quoteFormModal');
                    const instance = bootstrap.Modal.getInstance(modalEl) || new bootstrap.Modal(modalEl);
                    instance.hide();
                } catch (e) {}
                setTimeout(() => { window.location.href = '/?enquiry_submitted=1#products'; }, 1200);
            } else {
                if (msgEl) {
                    msgEl.textContent = data.message || 'Submission failed. Please try again.';
                    msgEl.style.display = '';
                    msgEl.classList.add('text-danger', 'small');
                }
            }
        } catch (err) {
            if (msgEl) {
                msgEl.textContent = 'Network error. Please try again.';
                msgEl.style.display = '';
                msgEl.classList.add('text-danger', 'small');
            }
        } finally {
            // Always restore button (if we're redirecting, this is harmless)
            if (submitBtn) {
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<i class="bi bi-send me-2"></i>Submit Quote Request';
            }
        }
    });
});
</script>


